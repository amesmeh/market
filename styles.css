/* Design tokens */
:root{
  /* Neutral Professional Palette */
  --bg:#f6f7f9;
  --bg-soft:#eef1f5;
  --panel:rgba(255,255,255,0.90);
  --panel-2:rgba(255,255,255,0.78);
  --glass-stroke:rgba(20,35,55,0.10);
  --text:#1e293b;
  --muted:#5f6b7a;
  --primary:#2f63c7;
  --primary-600:#2454b0;
  --primary-contrast:#132335;
  --accent-cyan:#2fa8d8;
  --accent-pink:#d8467d;
  --accent-lime:#5ab738;
  --accent-purple:#5f55c9;
  --accent-orange:#d88632;
  --success:#2f9e67;
  --warning:#d8a541;
  --danger:#d85757;
  --border: var(--glass-stroke);
  --hover:#e7edf4;
  /* section colors default (overridable by theme-*) */
  --c1:var(--primary);
  --c2:var(--accent-cyan);
  --radius:18px;
  --radius-sm:12px;
  --shadow-sm:0 4px 14px rgba(22,34,50,.06);
  --shadow-md:0 10px 28px rgba(22,34,50,.10);
  --shadow-lg:0 20px 52px rgba(22,34,50,.14);
  --grad-soft:linear-gradient(135deg, rgba(47,99,160,.08), rgba(47,99,160,.04));
  --grad-primary:linear-gradient(135deg, rgba(47,99,199,.16), rgba(36,84,176,.10));
  --grad-aurora:radial-gradient(1100px 560px at 80% -10%, rgba(47,99,199,.14), transparent 60%),
                 radial-gradient(900px 480px at -10% 10%, rgba(47,168,216,.12), transparent 65%),
                 radial-gradient(1200px 680px at 50% 120%, rgba(47,158,103,.10), transparent 65%);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:'Cairo','Tajawal',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background-image: var(--grad-aurora);
  background-attachment: fixed;
}

/* Dark theme override */
body.theme-dark{
  --bg:#0e1420;
  --bg-soft:#162132;
  --panel:rgba(255,255,255,0.07);
  --panel-2:rgba(255,255,255,0.05);
  --glass-stroke:rgba(255,255,255,0.12);
  --text:#e3e9f4;
  --muted:#9aa8bd;
  --shadow-sm:0 4px 14px rgba(0,0,0,.32);
  --shadow-md:0 10px 30px rgba(0,0,0,.40);
  --shadow-lg:0 22px 60px rgba(0,0,0,.52);
  --grad-soft:linear-gradient(135deg, rgba(47,99,199,.25), rgba(22,33,50,.40));
  --grad-primary:linear-gradient(135deg, rgba(47,99,199,.28), rgba(47,168,216,.16));
  --grad-aurora:radial-gradient(1100px 560px at 80% -10%, rgba(47,168,216,.32), transparent 60%),
                 radial-gradient(900px 480px at -10% 10%, rgba(95,85,201,.30), transparent 62%),
                 radial-gradient(1200px 680px at 50% 120%, rgba(47,158,103,.25), transparent 65%);
}

#app{display:flex;height:100vh;overflow:hidden}

.sidebar{
  width:220px;min-width:200px;max-width:240px;
  background:var(--panel);
  -webkit-backdrop-filter: blur(10px) saturate(1.4);
  backdrop-filter: blur(10px) saturate(1.4);
  border:1px solid var(--glass-stroke);
  padding:16px 12px;
  overflow:auto;
  box-shadow: var(--shadow-sm);
  background-image: var(--grad-soft);
  border-radius: 16px;
  margin:10px;
}
.sidebar.collapsed{width:64px;min-width:64px}
.sidebar.collapsed .menu button span:nth-child(2){display:none}
.sidebar.collapsed .logo span:nth-child(2){display:none}
.sidebar .logo{display:flex;align-items:center;gap:10px;margin:4px 8px 16px;font-weight:800;color:var(--primary-contrast)}
.sidebar .menu{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:4px}
.sidebar .menu li{border-radius:10px}
.sidebar .menu button{
  width:100%;text-align:start;display:flex;align-items:center;gap:12px;
  padding:10px 12px;border:1px solid transparent;background:transparent;color:var(--text);
  border-radius:12px;cursor:pointer;font-size:15px;
  transition: background .25s ease, color .2s ease, transform .06s ease, border-color .2s ease, box-shadow .25s ease;
}
.sidebar .menu button:hover{background:var(--hover)}
.sidebar .menu button:active{transform: scale(.98)}
.sidebar .menu button.active{background:linear-gradient(90deg, var(--c1), var(--c2));color:#fff;border-color:rgba(47,105,234,.24);box-shadow:0 6px 16px rgba(47,105,234,.15), 0 0 0 1px rgba(255,255,255,.22) inset, 0 0 0 2px color-mix(in srgb, var(--c1) 18%, transparent)}
.sidebar .menu button.active{position:relative}
.sidebar .menu button.active:after{content:"";position:absolute;inset: -2px; border-radius:12px; pointer-events:none; box-shadow: 0 0 14px color-mix(in srgb, var(--c1) 45%, transparent); opacity:.35}
.sidebar .menu .icon{width:22px;height:22px;display:grid;place-items:center}
.sidebar .menu .icon{transition: transform .15s ease}
.sidebar .menu button:hover .icon{transform: scale(1.15)}
.sidebar .menu button.active .icon{transform: scale(1.2)}
.sidebar.collapsed .menu .icon{transform: scale(1.1)}

.main{flex:1;display:flex;flex-direction:column;min-width:0}
.topbar{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 18px;background:var(--panel);
  border:1px solid var(--glass-stroke);
  position:sticky;top:0;z-index:10;
  -webkit-backdrop-filter: blur(8px) saturate(1.3);
  backdrop-filter: blur(8px) saturate(1.3);
  box-shadow: var(--shadow-sm);
  border-radius:16px;
  margin:10px;
}
.topbar h1{margin:0;font-size:20px;font-weight:700}

.stats{display:flex;gap:10px;flex-wrap:wrap}
.stats{row-gap:14px}
.stat-card{
  background:var(--panel);
  border:1px solid var(--glass-stroke);
  border-radius:18px;
  padding:14px 16px;display:flex;align-items:center;gap:12px;min-width:220px;
  box-shadow: var(--shadow-sm);
  background-image:linear-gradient(135deg, rgba(47,99,199,.12), rgba(47,168,216,.08));
}
.stat-card .ico{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg, rgba(47,99,199,.18), rgba(47,168,216,.15));display:grid;place-items:center;color:#1e293b;font-weight:800;box-shadow:inset 0 0 0 1px rgba(30,41,59,.08)}
.stat-card .val{font-weight:700}
.stat-card .lbl{font-size:12px;color:var(--muted)}

.content{padding:20px;overflow:auto;flex:1}
.panel{background:var(--panel);border:1px solid var(--glass-stroke);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow-sm);-webkit-backdrop-filter: blur(8px) saturate(1.15);backdrop-filter: blur(8px) saturate(1.15)}
.panel.highlight{border-color:var(--primary);box-shadow:0 0 0 3px rgba(93,163,240,.12)}

.breadcrumb{margin-bottom:12px;color:var(--muted)}

/* Section dynamic title bar */
.section-title-bar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:0 0 14px 0;padding:12px 16px;border:1px solid var(--glass-stroke);background:var(--panel);background-image:var(--grad-soft);border-radius:18px;box-shadow:var(--shadow-sm);font-weight:700;font-size:20px;line-height:1.2}
.section-title-bar small{font-weight:400;font-size:12px;color:var(--muted)}

/* Controls */
.button{background:linear-gradient(135deg, var(--c1), var(--c2));color:#fff;border:1px solid rgba(47,105,234,.28);border-radius:14px;padding:10px 14px;cursor:pointer;box-shadow:0 8px 22px rgba(47,105,234,.18), inset 0 0 0 1px rgba(255,255,255,.24);transition: transform .06s ease, box-shadow .25s ease, filter .15s ease}
.button:hover{filter:saturate(1.05) brightness(1.03);box-shadow:0 10px 28px rgba(47,105,234,.22), inset 0 0 0 1px rgba(255,255,255,.28)}
.button:active{transform: translateY(1px)}
.button.ghost{background:transparent;color:var(--primary);border:1px solid rgba(47,105,234,.28);box-shadow:none}
.input,select{width:100%;padding:10px 12px;border:1px solid var(--glass-stroke);border-radius:12px;background:#fff;color:var(--text);transition:border-color .15s ease, box-shadow .15s ease, background .15s ease}
.input:focus,select:focus{outline:none;border-color:rgba(47,105,234,.38);box-shadow:0 0 0 3px rgba(59,124,255,.18);background:#fff}
.grid{display:grid;gap:12px}
.grid.cols-2{grid-template-columns:repeat(2,1fr)}
.grid.cols-3{grid-template-columns:repeat(3,1fr)}
.grid.cols-4{grid-template-columns:repeat(4,1fr)}
@media (max-width:1000px){.grid.cols-4{grid-template-columns:repeat(2,1fr)}}
@media (max-width:700px){.grid.cols-3,.grid.cols-2,.grid.cols-4{grid-template-columns:1fr}}

/* Tables */
.table{width:100%;border-collapse:separate;border-spacing:0}
.table th,.table td{padding:12px;border-bottom:1px solid var(--border);text-align:start}
.table th{color:var(--muted);font-weight:700;background:linear-gradient(135deg, rgba(47,99,199,.06), rgba(47,168,216,.05))}
.table tr:nth-child(even) td{background:#f4f7fa}
.table tr:hover td{background:#e9f0f7}
.badge{display:inline-block;padding:6px 10px;border-radius:999px;background:linear-gradient(135deg, rgba(47,99,199,.18), rgba(47,168,216,.16));color:#1e293b;font-size:12px;font-weight:700;border:1px solid rgba(30,41,59,.08)}
.badge.info{background:linear-gradient(135deg, rgba(47,168,216,.26), rgba(47,99,199,.18));border-color:rgba(47,99,199,.30)}
.badge.purple{background:linear-gradient(135deg, rgba(95,85,201,.26), rgba(47,168,216,.18));border-color:rgba(95,85,201,.30)}
.toolbar{display:flex;gap:8px;flex-wrap:wrap}
.toolbar.tight{margin-bottom:6px}
.searchbar{display:flex;gap:8px;margin-bottom:12px}
.searchbar .input{max-width:400px}

/* Modals */
.modal-backdrop{position:fixed;inset:0;background:radial-gradient(1000px 600px at 50% -10%, rgba(47,99,199,.12), transparent 60%), rgba(255,255,255,.52);display:grid;place-items:center;z-index:9999}
/* keep dialogs readable in day mode: use semi-opaque white panel */
.modal{background:#ffffff;border:1px solid var(--glass-stroke);border-radius:18px;padding:16px;min-width:320px;max-width:90vw;box-shadow:var(--shadow-lg);-webkit-backdrop-filter: blur(10px) saturate(1.1);backdrop-filter: blur(10px) saturate(1.1)}
.modal .title{font-weight:700;margin-bottom:8px}
.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}

/* Sales/Purchases */
.invoice-head{background:linear-gradient(135deg, color-mix(in srgb, var(--c1) 22%, transparent), color-mix(in srgb, var(--c2) 14%, transparent));border:1px dashed rgba(47,105,234,.28);border-radius:16px;padding:12px;box-shadow:var(--shadow-sm)}
.invoice-head label{font-weight:700}
.invoice-summary{display:flex;gap:16px;justify-content:flex-end;margin-top:12px}
.mini{font-size:12px;color:var(--muted)}
.qty-ctrl{display:inline-flex;align-items:center;border:1px solid var(--border);border-radius:10px;overflow:hidden}
.qty-ctrl button{border:none;background:var(--bg);padding:6px 8px;cursor:pointer}
.qty-ctrl input{width:64px;border:none;text-align:center;padding:6px 8px}
.split-cols{display:grid;grid-template-columns:0.35fr 0.65fr;gap:16px}
.pane-products{background:linear-gradient(135deg, color-mix(in srgb, var(--c1) 10%, transparent), color-mix(in srgb, var(--c2) 10%, transparent));border:1px solid var(--glass-stroke);border-radius:16px;padding:12px;box-shadow:var(--shadow-sm);border-inline-end:2px solid color-mix(in srgb, var(--c1) 28%, transparent)}
.pane-invoice{background:linear-gradient(135deg, color-mix(in srgb, var(--c1) 10%, transparent), color-mix(in srgb, var(--c2) 8%, transparent));border:1px solid rgba(47,105,234,.22);border-radius:18px;padding:12px;box-shadow:var(--shadow-sm);border-inline-start:2px solid color-mix(in srgb, var(--c2) 24%, transparent)}
.pane-invoice .toolbar{border-bottom:1px dashed var(--border);padding-bottom:8px}
.pane-invoice .toolbar .button{border-radius:10px}
@media (max-width:900px){.split-cols{grid-template-columns:1fr}}

/* Emphasis */
.pane-invoice .toolbar .badge{font-weight:700}
.table td:nth-child(2), .table th:nth-child(2){font-weight:700}
.invoice-titlebar{background: linear-gradient(90deg, var(--c1), var(--c2));color:#fff;border:1px solid rgba(47,105,234,.22);border-radius:12px;padding:10px 12px;margin-bottom:8px;font-weight:900;letter-spacing:.2px;position:relative;overflow:hidden}
.invoice-titlebar:after{content:"";position:absolute;inset-inline:8px;bottom:6px;height:2px;background:linear-gradient(90deg, var(--accent-cyan), var(--accent-pink), var(--accent-lime));opacity:.55}

/* Underlines inside invoice */
.pane-invoice .table th{ border-bottom:2px solid color-mix(in srgb, var(--c1) 20%, transparent) }
.pane-invoice .table td{ border-bottom:2px dashed color-mix(in srgb, var(--c1) 14%, transparent) }
.invoice-summary{ border-top:2px solid color-mix(in srgb, var(--c2) 18%, transparent); padding-top:10px }

/* Print styles for invoices */
@media print{
  .sidebar, .topbar, .toolbar, .searchbar, #toggle-sidebar, #toggle-theme{ display:none !important; }
  body{ background:#fff !important; }
  .content{ padding:0 !important; }
  .pane-invoice, .invoice-head{ box-shadow:none !important; border:1px solid #ddd !important; background:#fff !important }
  .invoice-titlebar{ background:#fff !important; color:#000 !important; border:none !important }
}

/* Number inputs */
input[type=number][data-field="price"],
input[type=number]#cashPrice,
input[type=number]#bankPrice,
input[type=number]#e_cash,
input[type=number]#e_bank{
  appearance: textfield;
  -moz-appearance:textfield;
}
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button{ -webkit-appearance: none; margin: 0; }
input[data-field="price"]{ max-width: 340px !important; font-size:18px !important }

/* Color tags for statuses */
.badge.success{background:linear-gradient(135deg, color-mix(in srgb, var(--success) 55%, transparent), color-mix(in srgb, var(--success) 25%, transparent));border-color:color-mix(in srgb, var(--success) 50%, transparent)}
.badge.warning{background:linear-gradient(135deg, color-mix(in srgb, var(--warning) 55%, transparent), color-mix(in srgb, var(--warning) 25%, transparent));border-color:color-mix(in srgb, var(--warning) 50%, transparent)}
.badge.danger{background:linear-gradient(135deg, color-mix(in srgb, var(--danger) 55%, transparent), color-mix(in srgb, var(--danger) 25%, transparent));border-color:color-mix(in srgb, var(--danger) 50%, transparent)}

/* Section theme classes: override --c1/--c2 */
body.theme-products{ --c1:#2f63c7; --c2:#2fa8d8; }
body.theme-sales{ --c1:#5f55c9; --c2:#2f63c7; }
body.theme-purchases{ --c1:#2fa8d8; --c2:#2f9e67; }
body.theme-invoices{ --c1:#2f63c7; --c2:#d8a541; }
body.theme-expenses{ --c1:#d88632; --c2:#d8467d; }
body.theme-cashboxes{ --c1:#2f9e67; --c2:#2f63c7; }
body.theme-accounts{ --c1:#2f63c7; --c2:#5f55c9; }
body.theme-stats{ --c1:#2f63c7; --c2:#2fa8d8; }
body.theme-settings{ --c1:#2f63c7; --c2:#d88632; }
body.theme-debts{ --c1:#d8467d; --c2:#d88632; }
body.theme-partners{ --c1:#2fa8d8; --c2:#5f55c9; }
body.theme-calculator{ --c1:#2fa8d8; --c2:#2f63c7; }

/* Calculator */
.calc-wrapper{display:grid;gap:16px;grid-template-columns:320px 1fr;align-items:start}
@media (max-width:900px){.calc-wrapper{grid-template-columns:1fr}}
.calc-box{background:var(--panel);border:1px solid var(--glass-stroke);border-radius:22px;padding:18px;box-shadow:var(--shadow-sm);background-image:var(--grad-soft);display:flex;flex-direction:column;gap:14px;position:relative;overflow:hidden}
.calc-box:before{content:"";position:absolute;inset:0;background:radial-gradient(600px 400px at 85% -10%, color-mix(in srgb,var(--c1) 18%, transparent), transparent 70%);pointer-events:none}
.calc-display{background:#fff;border:1px solid var(--glass-stroke);border-radius:16px;padding:10px 14px;text-align:left;direction:ltr;font-family:Consolas,monospace;box-shadow:inset 0 0 0 1px rgba(0,0,0,.02);display:flex;flex-direction:column;gap:4px;min-height:86px}
.calc-display .expr{font-size:14px;color:var(--muted);word-break:break-all}
.calc-display .result{font-size:32px;font-weight:700;line-height:1;word-break:break-all;color:var(--primary-600)}
.calc-keys{display:grid;gap:10px;grid-template-columns:repeat(4,1fr)}
.calc-key{position:relative;border:none;border-radius:14px;padding:14px 10px;font-size:18px;font-weight:600;cursor:pointer;background:linear-gradient(135deg, color-mix(in srgb,var(--c1) 8%, #fff), color-mix(in srgb,var(--c2) 6%, #fff));box-shadow:0 4px 12px rgba(22,34,50,.08), inset 0 0 0 1px rgba(255,255,255,.4);color:#1e293b;transition:background .25s ease, transform .08s ease, box-shadow .25s ease, color .25s ease}
.calc-key:hover{background:linear-gradient(135deg, color-mix(in srgb,var(--c1) 14%, #fff), color-mix(in srgb,var(--c2) 10%, #fff))}
.calc-key:active{transform:translateY(2px)}
.calc-key.op{color:var(--primary-600);background:linear-gradient(135deg, color-mix(in srgb,var(--c1) 15%, #fff), color-mix(in srgb,var(--c2) 12%, #fff))}
.calc-key.eq{grid-column:span 2;background:linear-gradient(90deg, var(--c1), var(--c2));color:#fff;font-weight:700;box-shadow:0 6px 16px color-mix(in srgb,var(--c1) 40%, transparent), inset 0 0 0 1px rgba(255,255,255,.4)}
.calc-key.eq:hover{filter:brightness(1.05)}
.calc-key.fn{background:linear-gradient(135deg,#f2f4f7,#e9edf2);color:#475163}
.calc-key.fn:hover{background:linear-gradient(135deg,#eef1f5,#e3e8ed)}
.calc-history{background:var(--panel);border:1px solid var(--glass-stroke);border-radius:20px;padding:16px;box-shadow:var(--shadow-sm);max-height:400px;overflow:auto;display:flex;flex-direction:column;gap:8px}
.calc-history h3{margin:0 0 4px 0;font-size:14px;color:var(--muted);font-weight:600}
.calc-history-item{font-family:Consolas,monospace;font-size:13px;padding:6px 10px;border-radius:12px;background:#fff;border:1px solid var(--glass-stroke);display:flex;justify-content:space-between;gap:8px;cursor:pointer;transition:background .2s ease}
.calc-history-item:hover{background:#f0f4f8}
.calc-badge{font-size:11px;padding:2px 6px;border-radius:8px;background:linear-gradient(135deg, color-mix(in srgb,var(--c1) 25%, transparent), color-mix(in srgb,var(--c2) 18%, transparent));color:#1e293b;font-weight:600;border:1px solid color-mix(in srgb,var(--c1) 30%, transparent)}
.calc-toolbar{display:flex;flex-wrap:wrap;gap:8px}
.calc-toolbar button{font-size:12px;padding:8px 10px;border-radius:10px}
.calc-mem-indicator{font-size:11px;color:var(--muted);margin-inline-start:auto}

/* Debts */
.deb-client-row.active td{background:linear-gradient(90deg, color-mix(in srgb,var(--c1) 22%, transparent), color-mix(in srgb,var(--c2) 18%, transparent));color:#fff;font-weight:700}
.deb-client-row td{cursor:pointer}

/* Margin coloring in stats */
tr.margin-high td{background:linear-gradient(90deg, color-mix(in srgb,var(--success) 25%, transparent), transparent);}
tr.margin-mid td{background:linear-gradient(90deg, color-mix(in srgb,var(--warning) 22%, transparent), transparent);}
tr.margin-low td{background:linear-gradient(90deg, color-mix(in srgb,var(--danger) 18%, transparent), transparent);}
